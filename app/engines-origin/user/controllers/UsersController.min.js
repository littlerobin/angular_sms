angular.module("callburnApp").controller("UsersController",["$scope","$rootScope","$state","Restangular","timezones",function($scope,$rootScope,$state,Restangular,timezones){$rootScope.currentPage="edit-account",$scope.userEditableData={first_name:$rootScope.currentUser.first_name,last_name:$rootScope.currentUser.last_name,vat:$rootScope.currentUser.vat,address:$rootScope.currentUser.address,timezone:$rootScope.currentUser.timezone},$scope.verificationCall={},$scope.isVerificationCallMade=!1,$scope.successMessage=!1,$scope.errorMessage=!1,$scope.timezones=timezones.resource.timezones,$scope.showPaymentModal=!1,$scope.editPasswordData={},$scope.editEmailData={},$scope.updatePasswordErrorMessage=!1,$scope.updateEmailErrorMessage=!1,$scope.editAccountMainSuccessMessage=!1,$scope.editAccountMainErrorMessage=!1,$scope.creditRechargeErrorMessage=!1,$scope.sendVerificationCall=function(){Restangular.all("verifications/send-verification-code").post($scope.verificationCall).then(function(data){0==data.resource.error.no?($scope.isVerificationCallMade=!0,$scope.successMessage=$rootScope.trans("verification_call_made"),$scope.errorMessage=!1):($scope.errorMessage=data.resource.error.text,$scope.successMessage=!1)})},$scope.checkVerificationCode=function(){Restangular.all("users/add-caller-id").post($scope.verificationCall).then(function(data){0==data.resource.error.no?($scope.reloadUsersData(),$scope.verificationCall={},$scope.isVerificationCallMade=!1,$scope.successMessage="Verified and added",$scope.errorMessage=!1):($scope.errorMessage=data.resource.error.text,$scope.successMessage=!1)})},$scope.openRemoveNumberModal=function(id){$scope.numberIdToBeRemoved=id,$scope.showRemoveNumberConfirmationModal=!0},$scope.closeRemoveNumberModal=function(){$scope.numberIdToBeRemoved=null,$scope.showRemoveNumberConfirmationModal=!1},$scope.makePayment=function(){Restangular.all("billings/make-payment").post($scope.rechargeData).then(function(data){0==data.resource.error.no?($scope.showPaymentModal=!1,$scope.rechargeData={},$scope.editAccountMainSuccessMessage="Balance was recharged",$scope.reloadUsersData()):$scope.creditRechargeErrorMessage=data.resource.error.text})},$scope.removeNumber=function(id){Restangular.all("users/remove-number").post({id:id}).then(function(data){0==data.resource.error.no&&($scope.showRemoveNumberConfirmationModal=!1,$scope.reloadUsersData())})},$scope.reloadUsersData=function(){Restangular.one("users/show-user").get().then(function(data){data.resource.user_data&&($rootScope.currentUser=data.resource.user_data)})},$scope.editPassword=function(){Restangular.all("users/update-password").post($scope.editPasswordData).then(function(data){0==data.resource.error.no?($scope.showEditPasswordModal=!1,$scope.editAccountMainSuccessMessage="Password has been successfully changed",$scope.editPasswordData={}):$scope.updatePasswordErrorMessage=data.resource.error.text})},$scope.editEmail=function(){Restangular.all("users/update-email").post($scope.editEmailData).then(function(data){0==data.resource.error.no?($scope.showEditEmailModal=!1,$scope.editAccountMainSuccessMessage="Email has been successfully changed",$scope.editEmailData={}):$scope.updateEmailErrorMessage=data.resource.error.text})},$scope.editMainDetails=function(){Restangular.all("users/update-main-data").post($scope.userEditableData).then(function(data){0==data.resource.error.no?$scope.editAccountMainSuccessMessage="Account data updated":$scope.editAccountMainErrorMessage=data.resource.error.text})}}]);